## Workflow: wf-seekdeep-amplicon

The wf-seekdeep-amplicon directory contains scripts and resources for processing amplicon data (Illumina and Nanopore) generated using [SeekDeep](https://github.com/bailey-lab/SeekDeep). This directory is structured to facilitate the analysis of genomic data, including importing, processing, and summarizing variant data.

### Directory Structure

```
wf-seekdeep-amplicon/
|-- input/
|   |-- study_name/
|       |-- sequencing_id_name/
|            |-- seekdeep_analysis_name/
|                |-- info/
|                |-- output/
|                |-- reports/
|                |-- runLog_SeekDeep-setuptarampanalysis.txt
|                |-- selectedClustersInfo.tab.txt.gz
|                |-- allSelectedClustersInfo.tab.txt.gz
|-- scripts/
|   |-- functions/
|       |-- sequence-clusters/
|           |-- clusters-aggregate.R
|           |-- clusters-filter.R
|       |-- quality-control/
|           |-- qc-extraction-nanopore.R
|           |-- qc-extraction-illumina.R
|           |-- qc-samples-missing-data.R
|       |-- var-haplotype/
|           |-- hapfreq-dhps-clonal.R
|           |-- hapfreq-dhps-mixed.R
|           |-- hapfreq-dhfr-mixed.R
|           |-- hapfreq-target-clonal.R
|           |-- hapfreq-target-clonal-weighted.R
|       |-- var-snps/
|           |-- snpfreq-target.R
|           |-- snpfreq-target-weighted.R
|           |-- sp-resistance-profile.R
|       |-- study-related/
|           |-- add_samples_source.R
|   |-- main-seekdeep.R
|-- README.md
```

### Subdirectories and Files

- **`input/`**: Contains input data and directories for the analysis.
  - **`study_1/`**: Directory for storing study-specific files. This directory is created for each study.
    - **`sequencing_id_name/`**: This directory is created for each sequencing run, e.g: 2024_04_30_nanopore_r10.4.1 or 2024_04_30_illlumina_2x300. This names indicate the date of the sequencing run and the platform used.
      - **`seekdeep_analysis_name/`**: This directory is created for each SeekDeep analysis, e.g: 2024_05_03-01-seekdeep or 2024_05_03-02-seekdeep-ama1. This names indicate the date of the SeekDeep analysis and the run number.
        - **`info/`**: Contains information files generated in the SeekDeep output directory.
        - **`output/`**: Contains output files from the [main-seekdeep.R](scripts/main-seekdeep.R) script.
        - **`reports/`**: Contains analysis reports.
        - `runLog_SeekDeep-setuptarampanalysis.txt`: Log file for the SeekDeep analysis generated during setup and can be found in the SeekDeep output directory.
        - `selectedClustersInfo.tab.txt.gz`: Compressed file with selected cluster information generated by SeekDeep and can be found in the SeekDeep output directory.
        - `allSelectedClustersInfo.tab.txt.gz`: An alternative to the `selectedClustersInfo.tab.txt.gz` compressed file with selected cluster information generated by SeekDeep and can be found in the SeekDeep output directory. If you have multiple targets, SeekDeep will concatenate the cluster information for all targets into this file.
- **`scripts/`**: Contains R scripts for processing the data.
  - **`functions/`**: Includes various R scripts used in the analysis.
    - **`sequence-clusters/`**:
      - `clusters-aggregate.R`: Aggregates cluster data from SeekDeep outputs.
      - `clusters-filter.R`: Filters cluster data based on specific criteria.
    - **`quality-control/`**:
      - `qc-extraction-nanopore.R`: Processes FASTQ extraction reports for Nanopore data.
      - `qc-extraction-illumina.R`: Processes FASTQ extraction reports for Illumina data.
      - `qc-samples-missing-data.R`: Identifies samples with missing data.
    - **`var-haplotype/`**:
      - `hapfreq-dhps-clonal.R`: Computes haplotype frequencies for DHPS gene, assuming clonal samples.
      - `hapfreq-dhps-mixed.R`: Computes haplotype frequencies for DHPS gene in mixed infections.
      - `hapfreq-dhfr-mixed.R`: Computes haplotype frequencies for DHFR gene in mixed infections.
      - `hapfreq-target-clonal.R`: Computes haplotype frequencies for target genes assuming clonal samples.
      - `hapfreq-target-clonal-weighted.R`: Computes weighted haplotype frequencies for target genes.
    - **`var-snps/`**:
      - `snpfreq-target.R`: Computes SNP frequencies for target genes.
      - `snpfreq-target-weighted.R`: Computes weighted SNP frequencies for target genes.
      - `sp-resistance-profile.R`: Determines resistance profiles for DFHR and DHPS based on SNP data.
    - **`study-related/`**:
      - `add_samples_source.R`: Adds sample source information to the data.
  - **`main-seekdeep.R`**: The main R script for processing amplicon data using SeekDeep.
- **`README.md`**: Contains documentation and instructions for this workflow.

### Dependencies

The scripts in this directory require R (version 4.0.0 or higher) and several R packages, including `tidyverse`, `data.table`, and `janitor`. Ensure you have these packages installed before running the scripts.

### Script Overview

main-seekdeep.R

- This is the main script for processing amplicon data using SeekDeep.
- It performs the following tasks:
  - Imports and processes read extraction quality control reports.
  - Aggregates cluster data and adds sample source information.
  - Identifies samples without data.
  - Performs gene-specific analysis for targets such as PfAMA1, PfK13, PfMDR1, PfDHPS, and PfDHFR.
    - Computes allele frequencies and haplotype frequencies.
    - Saves processed data into CSV files for each gene.

### Usage

- Ensure that all input data is correctly placed in the `input/` directory.
- The scripts are designed to handle both Illumina and Nanopore amplicon data.
- Output files will be saved in the `output/` directory within the specified analysis path.
